(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{195:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var r=n(1),a=n(9),o=(n(0),n(202)),s={id:"mesh-transforms",title:"Mesh Transforms",sidebar_label:"4. Mesh Transforms"},i={id:"getting-started/mesh-transforms",title:"Mesh Transforms",description:"## Introduction to Transforms",source:"@site/docs/getting-started/mesh-transforms.md",permalink:"/docs/getting-started/mesh-transforms",editUrl:"https://github.com/urigo/graphql-mesh/edit/master/website/docs/getting-started/mesh-transforms.md",sidebar_label:"4. Mesh Transforms",sidebar:"sidebar",previous:{title:"Basic Usage",permalink:"/docs/getting-started/basic-example"},next:{title:"Multiple APIs",permalink:"/docs/getting-started/multiple-apis"}},l=[{value:"Introduction to Transforms",id:"introduction-to-transforms",children:[]},{value:"Handler-level transforms",id:"handler-level-transforms",children:[]},{value:"Root-level transforms",id:"root-level-transforms",children:[]},{value:"Usage Example",id:"usage-example",children:[]}],c={rightToc:l};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"introduction-to-transforms"},"Introduction to Transforms"),Object(o.b)("p",null,"GraphQL Mesh allow you to do schema transformations easily, you can use one of the built-in transforms, or write your own."),Object(o.b)("p",null,"Each transformer can manipulate the schema the way it needs, and return the modified schema."),Object(o.b)("p",null,"You can find a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/transforms/available-transforms"}),"list of available transforms here"),"."),Object(o.b)("p",null,"Transforms are specified as a list of objects, and they are executed in order, and you can apply them over a specific input source, or over the unified schema (after merging all sources)."),Object(o.b)("h2",{id:"handler-level-transforms"},"Handler-level transforms"),Object(o.b)("p",null,"To specify ",Object(o.b)("inlineCode",{parentName:"p"},"transforms")," over a specific source, add it to your ",Object(o.b)("inlineCode",{parentName:"p"},"sources")," section under the source you wish to modify."),Object(o.b)("p",null,"The following example prefixes an input source to make it simpler later to merge and avoid conflicts:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yml"}),"sources:\n  - name: Wiki\n    handler:\n      openapi:\n        source: https://api.apis.guru/v2/specs/wikimedia.org/1.0.0/swagger.yaml\n    transforms:\n      - prefix:\n          value: Wiki_\n")),Object(o.b)("h2",{id:"root-level-transforms"},"Root-level transforms"),Object(o.b)("p",null,"To specify ",Object(o.b)("inlineCode",{parentName:"p"},"transforms")," over unified schema, you should put it in the root of your config file. This could be used in case you need access fields or types from all your data source, for example for linking two data sources together."),Object(o.b)("p",null,"The following example prefixes an input source to make it simpler later to merge and avoid conflicts:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yml"}),"sources:\n  - name: Users\n    handler: #...\n  - name: Posts\n    handler: #...\ntransforms:\n  - extend: |\n      extend type User {\n        posts: [Posts!]!\n      }\n\n      extend type Post {\n        author: User!\n      }\n")),Object(o.b)("h2",{id:"usage-example"},"Usage Example"),Object(o.b)("p",null,"You can add custom resolvers and custom GraphQL schema SDL, and use the API SDK to fetch the data and manipulate it. So the query above could be simplified with custom logic."),Object(o.b)("p",null,"This is possible because GraphQL Mesh will make sure to expose all available services in each API in your ",Object(o.b)("inlineCode",{parentName:"p"},"context")," object."),Object(o.b)("p",null,"It's named the same as the API name, so to access the API of ",Object(o.b)("inlineCode",{parentName:"p"},"Wiki")," source, you can use ",Object(o.b)("inlineCode",{parentName:"p"},"context.Wiki.api")," and use the methods you need. It's useful when you need add custom behaviours, fields and types, and also for linking types between schemas."),Object(o.b)("p",null,"In the following example, we will add take the query we has in the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/getting-started/basic-example"}),"previous example"),", and simplify it by adding a new root operation to ",Object(o.b)("inlineCode",{parentName:"p"},"Query")," type, and automate the variables that it needs, in order to create a simpler version of it for the consumers."),Object(o.b)("p",null,"To add a new simple field, that just returns the amount of views for the past month, you can wrap it as following in your GraphQL config file, and add custom resolvers file using ",Object(o.b)("inlineCode",{parentName:"p"},"additionalResolvers")," field:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yml"}),"sources:\n  - name: Wiki\n    handler:\n      openapi:\n        source: https://api.apis.guru/v2/specs/wikimedia.org/1.0.0/swagger.yaml\n    transforms:\n      - extend: |\n          extend type Query {\n            viewsInPastMonth(project: String!): Float!\n          }\nadditionalResolvers:\n  - ./src/mesh/additional-resolvers.js\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"We are using a Mesh transformer called ",Object(o.b)("inlineCode",{parentName:"p"},"extend")," - you can use it to extend types and add custom SDL to your schema.")),Object(o.b)("p",null,"Now, we need to implement ",Object(o.b)("inlineCode",{parentName:"p"},"src/mesh/additional-resolvers.js")," with code that fetches and manipulate the data:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const moment = require('moment');\n\nconst resolvers = {\n  Query: {\n    viewsInPastMonth: async (root, args, { Wiki }) => {\n      const {\n        items\n      } = await Wiki.api.getMetricsPageviewsAggregateProjectAccessAgentGranularityStartEnd(\n        {\n          access: 'all-access',\n          agent: 'user',\n          end: moment().format('YYYYMMDD'),\n          start: moment()\n            .startOf('month')\n            .subtract(1, 'month')\n            .format('YYYYMMDD'),\n          project: args.project,\n          granularity: 'monthly'\n        }\n      );\n\n      if (!items || items.length === 0) {\n        return 0;\n      }\n\n      return items[0].views;\n    }\n  }\n};\n\nmodule.exports = { resolvers };\n")),Object(o.b)("p",null,"Now run ",Object(o.b)("inlineCode",{parentName:"p"},"graphql-mesh serve")," and you'll be able to see your new field as part of your GraphQL schema, and you'll be able to query for it."),Object(o.b)("p",null,"And now we run the the following GraphQL query to fetch the simplified data:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-graphql"}),'query viewsInPastMonth {\n  viewsInPastMonth(project: "en.wikipedia.org")\n}\n')),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"You can find the complete example ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/Urigo/graphql-mesh/tree/master/examples/javascript-wiki"}),"here"))))}p.isMDXComponent=!0},202:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return b}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=a.a.createContext({}),p=function(e){var t=a.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i({},t,{},e)),n},u=function(e){var t=p(e.components);return a.a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,b=u["".concat(s,".").concat(d)]||u[d]||m[d]||o;return n?a.a.createElement(b,i({ref:t},c,{components:n})):a.a.createElement(b,i({ref:t},c))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);