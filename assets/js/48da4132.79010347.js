(self.webpackChunk_graphql_mesh_website=self.webpackChunk_graphql_mesh_website||[]).push([[9297],{5318:function(e,n,t){"use strict";t.d(n,{Zo:function(){return p},kt:function(){return k}});var a=t(7378);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),m=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=m(e.components);return a.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=m(t),k=r,d=u["".concat(s,".").concat(k)]||u[k]||c[k]||o;return t?a.createElement(d,l(l({ref:n},p),{},{components:t})):a.createElement(d,l({ref:n},p))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=u;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var m=2;m<o;m++)l[m]=t[m];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8907:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return l},metadata:function(){return i},toc:function(){return s},default:function(){return p}});var a=t(9603),r=t(120),o=(t(7378),t(5318)),l={id:"mock",title:"Mock Transform",sidebar_label:"Mock"},i={unversionedId:"transforms/mock",id:"transforms/mock",isDocsHomePage:!1,title:"Mock Transform",description:"The mock transform allow you to apply mocking for development usage.",source:"@site/docs/transforms/mock.md",sourceDirName:"transforms",slug:"/transforms/mock",permalink:"/docs/transforms/mock",editUrl:"https://github.com/urigo/graphql-mesh/edit/master/website/docs/transforms/mock.md",version:"current",sidebar_label:"Mock",frontMatter:{id:"mock",title:"Mock Transform",sidebar_label:"Mock"},sidebar:"sidebar",previous:{title:"Snapshot Transform",permalink:"/docs/transforms/snapshot"},next:{title:"Resolvers Composition Transform",permalink:"/docs/transforms/resolvers-composition"}},s=[{value:"How to use?",id:"how-to-use",children:[]},{value:"Custom mock functions for types",id:"custom-mock-functions-for-types",children:[]},{value:"Custom mock functions for fields",id:"custom-mock-functions-for-fields",children:[]},{value:"Mocking the lists",id:"mocking-the-lists",children:[]},{value:"Stateful mocking",id:"stateful-mocking",children:[]},{value:"Codesandbox Example",id:"codesandbox-example",children:[]},{value:"Config API Reference",id:"config-api-reference",children:[]}],m={toc:s};function p(e){var n=e.components,t=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"mock")," transform allow you to apply mocking for development usage."),(0,o.kt)("p",null,"To get started with this transform, install it from npm:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"yarn add @graphql-mesh/transform-mock\n")),(0,o.kt)("h2",{id:"how-to-use"},"How to use?"),(0,o.kt)("p",null,"Add the following configuration to your Mesh config file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"transforms:\n  - mock:\n      mocks:\n        - apply: User.firstName\n          faker: '{{name.firstName}}'\n")),(0,o.kt)("p",null,"The example above will replace the resolver of ",(0,o.kt)("inlineCode",{parentName:"p"},"User.firstName")," with a mock that uses ",(0,o.kt)("inlineCode",{parentName:"p"},"faker.js")," to generate a random name."),(0,o.kt)("h2",{id:"custom-mock-functions-for-types"},"Custom mock functions for types"),(0,o.kt)("p",null,"You can mock types with custom mock functions like below;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"transforms:\n  - mock:\n      mocks:\n        - apply: DateTime\n          custom: graphql-scalars#DateTimeMock \n          # This will import `DateTimeMock` from `graphql-scalars` for example. Local paths are also supported\n")),(0,o.kt)("h2",{id:"custom-mock-functions-for-fields"},"Custom mock functions for fields"),(0,o.kt)("p",null,"You can mock a specific field of a type;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"transforms:\n  - mock:\n      mocks: \n        - apply: User.fullName\n          custom: ./user-mocks#fullName\n")),(0,o.kt)("p",null,"in ",(0,o.kt)("inlineCode",{parentName:"p"},"user-mocks.js")," file;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  fullName: () => 'My Static Name'\n};\n")),(0,o.kt)("p",null,"When defined manually, properties can return values either directly, or through a method. This is useful when defining static mocks, because a mock property will be called as many times as there are items, for example in an array.\nHere's an example on how this could be achieved:"),(0,o.kt)("p",null,"in ",(0,o.kt)("inlineCode",{parentName:"p"},"user-mocks.js")," file;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function* generateNames() {\n  while (true) {\n    yield "John Doe";\n    yield "John Snow";\n  }\n}\n\nconst fullNames = generateNames();\n\nexport const fullName = () => fullNames.next().value;\n')),(0,o.kt)("p",null,"and in case you are using ",(0,o.kt)("a",{parentName:"p",href:"https://www.graphql-mesh.com/docs/recipes/typescript"},"typescript")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"user-mocks.ts")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { User } from './types/mesh';\n\nfunction* generateNames(): Generator<string> {\n  while (true) {\n    yield \"John Doe\";\n    yield \"John Snow\";\n  }\n}\n\nconst fullNames = generateNames();\n\nexport const fullName: () => User['fullName'] = () => fullNames.next().value;\n")),(0,o.kt)("h2",{id:"mocking-the-lists"},"Mocking the lists"),(0,o.kt)("p",null,"By default, Mesh generates two mocked items if the return type is a list. But this can be configured;"),(0,o.kt)("p",null,"Let's say, you have a schema like below;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"  type Query {\n    users: [User]\n  }\n  type User {\n    id: ID\n    fullName: String\n  }\n")),(0,o.kt)("p",null,"Then a configuration like below;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"transforms:\n  - mock:\n      mocks: \n        - apply: User.fullName\n          faker: '{{name.fullName}}'\n        - apply: Query.users\n          length: 3\n")),(0,o.kt)("p",null,"Now ",(0,o.kt)("inlineCode",{parentName:"p"},"{ users { id fullName } }")," query will return 3 of ",(0,o.kt)("inlineCode",{parentName:"p"},"User")," item;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "users": [\n    {\n      "id": "SOME_RANDOM_ID",\n      "fullName": "John Doe"\n    },    \n    {\n      "id": "SOME_RANDOM_ID",\n      "fullName": "Jane Doe"\n    },\n    {\n      "id": "SOME_RANDOM_ID",\n      "fullName": "The Other Doe"\n    }\n  ]\n}\n')),(0,o.kt)("h2",{id:"stateful-mocking"},"Stateful mocking"),(0,o.kt)("p",null,"GraphQL Mesh supports GraphQL Tools's Stateful Mocking feature. So you can have stateful mocking by using the store provided in the context ",(0,o.kt)("inlineCode",{parentName:"p"},"context.mockStore"),";"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"type User {\n  id: ID\n  name: String\n}\ntype Query {\n  me: User\n}\ntype Mutation {\n  changeMyName(newName: String): User\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"transforms:\n  - mock:\n      mocks: \n        - apply: Mutation.changeMyName\n          custom: ./myMocks#changeMyName\n")),(0,o.kt)("p",null,"In the code part;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  changeMyName: (_, { newName }, { mockStore }) => {\n    mockStore.set('Query', 'ROOT', 'me', { name: newName });\n    return mockStore.get('Query', 'ROOT', 'me');\n  } \n}\n")),(0,o.kt)("p",null,"You can also implement ",(0,o.kt)("inlineCode",{parentName:"p"},"*ById")," field declaratively like below;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"type Query {\n  user(id:ID) : User\n}\ntype Mutation {\n  updateUser(id: ID, name: String): User\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},'transforms:\n  - mock:\n      mocks: \n        - apply: Query.user\n          store:\n            type: User\n            key: "{args.id}" \n        - apply: Mutation.addUser\n          updateStore:\n            type: User\n            key: "{random}"\n            fieldName: name\n            value: "{args.name}"\n          store: # return created user\n            type: User\n            key: "{random}"\n        - apply: Mutation.updateUser\n          custom: ./mocks#updateUser\n        # or you can do the following\n          updateStore:\n            type: User\n            key: "{args.id}"\n            fieldName: name\n            value: "{args.name}"\n          store: # return updated user\n            type: User\n            key: "{args.id}"\n\n')),(0,o.kt)("p",null,"And in ",(0,o.kt)("inlineCode",{parentName:"p"},"mocks.js"),";"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports.updateUser = (_, { id, name }, { mockStore }) => {\n  mockStore.set('User', id, { name });\n  return mockStore.get('User', id);\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Learn more about GraphQL Tools Mocking; ",(0,o.kt)("a",{parentName:"p",href:"https://www.graphql-tools.com/docs/mocking"},"https://www.graphql-tools.com/docs/mocking"))),(0,o.kt)("h2",{id:"codesandbox-example"},"Codesandbox Example"),(0,o.kt)("p",null,"You can check out our example that uses JSON Schema handler with mock data."),(0,o.kt)("iframe",{src:"https://codesandbox.io/embed/github/Urigo/graphql-mesh/tree/master/examples/json-schema-example?fontsize=14&hidenavigation=1&theme=dark&module=%2F.meshrc.yml",style:{width:"100%",height:"500px",border:"0",borderRadius:"4px",overflow:"hidden"},title:"json-schema-example",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"}),(0,o.kt)("h2",{id:"config-api-reference"},"Config API Reference"),(0,o.kt)("p",null,(0,o.kt)("ul",{parentName:"p"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"if")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Boolean"),") - If this expression is truthy, mocking would be enabled\nYou can use environment variables expression, for example: ",(0,o.kt)("inlineCode",{parentName:"li"},"${MOCKING_ENABLED}")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"preserveResolvers")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Boolean"),") - Do not mock any other resolvers other than defined in ",(0,o.kt)("inlineCode",{parentName:"li"},"mocks"),".\nFor example, you can enable this if you don't want to mock entire schema but partially."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"mocks")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Array of Object"),") - Mock configurations: ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"apply")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),", required) - Resolver path\nExample: User.firstName"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"if")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Boolean"),") - If this expression is truthy, mocking would be enabled\nYou can use environment variables expression, for example: ",(0,o.kt)("inlineCode",{parentName:"li"},"${MOCKING_ENABLED}")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"faker")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),") - Faker.js expression or function\nRead more (",(0,o.kt)("a",{parentName:"li",href:"https://github.com/marak/Faker.js/#fakerfake"},"https://github.com/marak/Faker.js/#fakerfake"),')\nExample;\nfaker: name.firstName\nfaker: "{{ name.firstName }} {{ name.lastName }}"'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"custom")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),') - Custom mocking\nIt can be a module or json file.\nBoth "moduleName#exportName" or only "moduleName" would work'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"length")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Int"),") - Length of the mock list\nFor the list types ",(0,o.kt)("inlineCode",{parentName:"li"},"[ObjectType]"),", how many ",(0,o.kt)("inlineCode",{parentName:"li"},"ObjectType")," you want to return?\ndefault: 2"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"store")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Object"),") - Get the data from the mock store: ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"type")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"key")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"ID"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fieldName")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),")"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"updateStore")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Array of Object"),") - Update the data on the mock store: ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"type")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"key")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"ID"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fieldName")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"value")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"String"),")"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"initializeStore")," (type: ",(0,o.kt)("inlineCode",{parentName:"li"},"Any"),") - The path to the code runs before the store is attached to the schema"))))}p.isMDXComponent=!0}}]);