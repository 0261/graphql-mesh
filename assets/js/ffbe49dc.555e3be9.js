(self.webpackChunk_graphql_mesh_website=self.webpackChunk_graphql_mesh_website||[]).push([[1531],{5318:function(e,t,r){"use strict";r.d(t,{Zo:function(){return p},kt:function(){return m}});var n=r(7378);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=l(r),m=i,d=h["".concat(c,".").concat(m)]||h[m]||u[m]||o;return r?n.createElement(d,a(a({ref:t},p),{},{components:r})):n.createElement(d,a({ref:t},p))}));function m(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,a=new Array(o);a[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var l=2;l<o;l++)a[l]=r[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},2053:function(e,t,r){"use strict";r.r(t),r.d(t,{frontMatter:function(){return s},metadata:function(){return c},toc:function(){return l},default:function(){return u}});var n=r(9603),i=r(120),o=(r(7378),r(5318)),a=["components"],s={id:"introspection-cache",title:"Introspection cache",sidebar_label:"Introspection cache"},c={unversionedId:"recipes/introspection-cache",id:"recipes/introspection-cache",isDocsHomePage:!1,title:"Introspection cache",description:"By default GraphQL Mesh fetches your remote data sources at runtime, during initialisation, to retrieve their raw schema and potentially translate it into GraphQL (when relevant).",source:"@site/docs/recipes/introspection-cache.md",sourceDirName:"recipes",slug:"/recipes/introspection-cache",permalink:"/docs/recipes/introspection-cache",editUrl:"https://github.com/urigo/graphql-mesh/edit/master/website/docs/recipes/introspection-cache.md",version:"current",sidebar_label:"Introspection cache",frontMatter:{id:"introspection-cache",title:"Introspection cache",sidebar_label:"Introspection cache"},sidebar:"sidebar",previous:{title:"Apollo Federation",permalink:"/docs/recipes/federation"},next:{title:"Handle Webhooks with GraphQL Subscriptions",permalink:"/docs/recipes/subscriptions-webhooks"}},l=[{value:"Setting the Mesh Config file",id:"setting-the-mesh-config-file",children:[]},{value:"Setup the script to write the cache",id:"setup-the-script-to-write-the-cache",children:[]}],p={toc:l};function u(e){var t=e.components,r=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"By default GraphQL Mesh fetches your remote data sources at runtime, during initialisation, to retrieve their raw schema and potentially translate it into GraphQL (when relevant).",(0,o.kt)("br",{parentName:"p"}),"\n","However, to reduce dependencies at runtime, GraphQL Mesh allows you to cache the raw schema of your remote data sources so they are locally available at runtime.",(0,o.kt)("br",{parentName:"p"}),"\n","This is important because if, for instance, one of the data sources you consume experiences downtime when your GraphQL Mesh server is starting, this would cause a failure and will ultimately force you to restart your server; effectively making this unavailable until you're able to start it successfully (in this case, only when all your data sources can provide their raw schemas).",(0,o.kt)("br",{parentName:"p"}),"\n","By following the steps below, you can instead move this dependency from runtime to build-time, by invoking a command that downloads the remote schemas and save them into a local file to be used as cache during server initialisation. In this case if one of your remote resources is not available when you attempt to build this local cache, it would cause a build failure which will stop your deployment process; hence not affecting your service availability."),(0,o.kt)("p",null,"To achieve this, you just need to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Tell Mesh, through config file (",(0,o.kt)("inlineCode",{parentName:"li"},".meshrc.yaml"),"), which file you want to use to cache remote sources raw schemas"),(0,o.kt)("li",{parentName:"ul"},"Set a script, to be invoked at build-time, to fetch and cache your remote sources raw schemas (leveraging Mesh CLI)")),(0,o.kt)("h2",{id:"setting-the-mesh-config-file"},"Setting the Mesh Config file"),(0,o.kt)("p",null,"You just need to add the ",(0,o.kt)("inlineCode",{parentName:"p"},"introspectionCache")," property to your ",(0,o.kt)("inlineCode",{parentName:"p"},".meshrc.yaml")," file, like below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"introspectionCache: ./introspectionCache.json\nsources: [...]\ntransforms: [...]\n")),(0,o.kt)("p",null,"When this property is set, Mesh will attempt to read from this file during initialisation, and will use the raw schemas available there; hence preventing network requests that would otherwise be required to retrieve the raw schemas from your remote data sources directly."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"NOTE: make sure your designated file has a ",(0,o.kt)("inlineCode",{parentName:"p"},"json")," extension.")),(0,o.kt)("h2",{id:"setup-the-script-to-write-the-cache"},"Setup the script to write the cache"),(0,o.kt)("p",null,"Mesh CLI provides you the ",(0,o.kt)("inlineCode",{parentName:"p"},"write-introspection-cache"),"command which goes through all your remote data sources, retrieves their raw schemas, and eventually store these into your designated file. This command does not require any argument, since it is aware of your nominated ",(0,o.kt)("inlineCode",{parentName:"p"},"introspectionCache")," file from the property set in your Mesh Config."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"NOTE: Make sure you have installed the ",(0,o.kt)("inlineCode",{parentName:"p"},"@graphql-mesh/cli")," package to run CLI commands.")),(0,o.kt)("p",null,"Here is an example of how you might want to set up your build script in ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "graphql-mesh-server",\n  ...\n  "main": "src/index.js",\n  "scripts": {\n    "write-introspection-cache": "graphql-mesh write-introspection-cache",\n    "build": "npm run write-introspection-cache && babel src -d dist",\n    ...\n  },\n  ...\n}\n')),(0,o.kt)("p",null,"Alternatively, you might prefer to set up a step in your CI that invokes ",(0,o.kt)("inlineCode",{parentName:"p"},"write-introspection-cache"),".",(0,o.kt)("br",{parentName:"p"}),"\n","The key point is to make sure that this command is invoked before you attempt to start the server, so that when initialising Mesh will find the introspection cache file and read from it, as opposed to querying your remote sources."))}u.isMDXComponent=!0}}]);